<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Cliente - ExtraEstetica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/panel.css">
    <script>
        // VerificaciÃ³n de sesiÃ³n inmediata
        if (!localStorage.getItem('token')) {
            window.location.href = '/';
        }
    </script>
</head>
<body class="py-5">
    <div class="container">
        
        <div class="d-flex justify-content-between align-items-center card-custom welcome-header mb-4 p-3 shadow-sm">
            <h3 class="mb-0">Hola, <span id="userName" class="fw-bold">Cliente</span> ðŸ‘‹</h3>
            <button onclick="logout()" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-box-arrow-right"></i> Salir
            </button>
        </div>

        <div class="row g-4">
            
            <div class="col-md-5">
                <div class="card-custom p-4 shadow-sm border-0">
                    <h4 class="mb-4 text-center fw-bold" style="color: var(--color-militar);">
                        <i class="bi bi-calendar-plus"></i> Nueva Cita
                    </h4>
                    
                    <form id="citaForm">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Â¿QuÃ© servicio necesitas?</label>
                            <select id="servicio" class="form-select" required>
                                <option value="" selected disabled>Selecciona una opciÃ³n...</option>
                                <% if (services && services.length > 0) { %>
                                    <% services.forEach(service => { %>
                                        <option value="<%= service.id %>">
                                            <%= service.nombre %> â€” $<%= service.precio %> MXN
                                        </option>
                                    <% }) %>
                                <% } else { %>
                                    <option disabled>No hay servicios disponibles</option>
                                <% } %>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Fecha y Hora</label>
                            <input type="datetime-local" id="fecha" class="form-control" required>
                            <div class="form-text text-muted">
                                <i class="bi bi-info-circle"></i> Horario: Lun-Vie 08:00 - 19:00
                            </div>
                        </div>

                        <div class="alert alert-warning d-flex align-items-center p-3 mb-4" role="alert">
                            <i class="bi bi-cash-coin fs-3 me-3"></i>
                            <div>
                                <strong class="d-block">Pago en Efectivo</strong>
                                <small>Por el momento, solo recibimos efectivo al finalizar tu servicio.</small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-militar w-100 py-2 fw-bold">
                            Agendar Cita
                        </button>
                        <div id="mensaje" class="mt-3 text-center"></div>
                    </form>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card-custom p-4 shadow-sm border-0">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h4 class="mb-0 fw-bold">ðŸ“‹ Tus Citas</h4>
                        <button onclick="cargarCitas()" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise"></i> Actualizar
                        </button>
                    </div>
                    <p class="text-muted small mb-4">
                        AquÃ­ puedes ver el costo estimado que deberÃ¡s cubrir en tu visita.
                    </p>

                    <ul id="listaCitas" class="list-group list-group-flush">
                        <div class="text-center py-5">
                            <div class="spinner-border text-secondary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/js/panel.js"></script>

    <script>
        // LÃ³gica de UI local
        const user = JSON.parse(localStorage.getItem('user'));
        if (user && user.nombre) {
            document.getElementById('userName').innerText = user.nombre;
        }

        const inputFecha = document.getElementById('fecha');
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        inputFecha.min = now.toISOString().slice(0, 16);

        function logout() {
            localStorage.clear();
            window.location.href = '/';
        }
    </script>
</body>
</html>